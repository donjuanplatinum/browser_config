(()=>{var e={172:e=>{e.exports=function(){let e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/[\/\?<>\\:\*\|"~]/g,n=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+/,r=/^(.+)\.([a-z0-9]{1,4})$/i,a="nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),i=[["amp","quot","lt","gt"],[38,34,60,62]],c=/&([^;]{2,6});/g,s=/\r?\n/g,u=/[\*\?"]/g,d=/</g,_=/>/g,l=/[\s\t\uFEFF\xA0]+/g,m=/(\.|!|\?|_|,|\-|:|\+){2,}/g,f=/[\.,:;\/\-_\+=']$/g;return{t:function(e,t,n){if(!e)return null;n=n?`_${n}`:"";let o,r="video_keeper_"+(t=t?`${t}_`:"");try{let t=new URL(e);o=null==t.searchParams.get("br")?r+t.pathname.split("/")[1]+"_"+t.pathname.split("/")[3]+n+".mp4":r+t.searchParams.get("br")+"_"+t.searchParams.get("bt")+n+".mp4"}catch(e){o=r+Date.now()+".mp4"}return o},i:function(v){if(!v)return"";v=function(e){try{return JSON.parse(JSON.stringify(e).replace(/\\(\\u[0-9a-f]{4})/g,"$1"))}catch(t){return e}}(v);try{v=decodeURIComponent(v)}catch(e){v=unescape(v)}if((v=(v=function(t){return t.replace(e,"")}(v=(v=v.replace(c,(function(e,t){var n=null;if("#"===t[0])return n=parseInt(t.substr(1)),isNaN(n)?"":String.fromCharCode(n);var o=i[0].indexOf(t);return-1!==o?(n=i[1][o],String.fromCharCode(n)):-1!==(o=a.indexOf(t))?(n=o+160,String.fromCharCode(n)):""}))).replace(s," "))).replace(u,"").replace(d,"(").replace(_,")").replace(l," ").replace(m,"$1").replace(t,"_").replace(n,"").replace(o,"").replace(f,"")).length<=this.maxLength)return v;var p=function(e){return e.match(r)}(v);return p&&3===p.length?(p[1]=p[1].substr(0,this.maxLength),p[1]+"."+p[2]):v}}}()},178:e=>{e.exports={u:"260103",_:3,l:1988,m:"api-h2.tiktokv.com",v:"26.1.3",p:"tiktok.com",g:["rate","one_by_one_warning_disabled","selectors","secUids","rate_count"],h:15,$:"rr",k:4,O:9,T:5,A:2,I:"mt_",S:1,U:6,B:7,N:2,F:"https://check.qippin.com/config.json",P:"config_mtime",D:17,M:1}},798:function(e){var t=t||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=e.URL||e.webkitURL||e,o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r=!e.externalHost&&"download"in o,a=e.webkitRequestFileSystem,i=e.requestFileSystem||a||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},s="application/octet-stream",u=0,d=[],_=function(){for(var e=d.length;e--;){var t=d[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}d.length=0},l=function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){c(e)}}},m=function(n,c){var _,m,f,v=this,p=n.type,g=!1,h=function(){var t=(e.URL||e.webkitURL||e).createObjectURL(n);return d.push(t),t},w=function(){l(v,"writestart progress write writeend".split(" "))},$=function(){!g&&_||(_=h()),m?m.location.href=_:window.open(_,"_blank"),v.readyState=v.DONE,w()},k=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},y={create:!0,exclusive:!1};if(v.readyState=v.INIT,c||(c="download"),r){_=h(),t=e.document,(o=t.createElementNS("http://www.w3.org/1999/xhtml","a")).href=_,o.download=c;var b=t.createEvent("MouseEvents");return b.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(b),v.readyState=v.DONE,void w()}e.chrome&&p&&p!==s&&(f=n.slice||n.webkitSlice,n=f.call(n,0,n.size,s),g=!0),a&&"download"!==c&&(c+=".download"),(p===s||a)&&(m=e),i?(u+=n.size,i(e.TEMPORARY,u,k((function(e){e.root.getDirectory("saved",y,k((function(e){var t=function(){e.getFile(c,y,k((function(e){e.createWriter(k((function(t){t.onwriteend=function(t){m.location.href=e.toURL(),d.push(e),v.readyState=v.DONE,l(v,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&$()},"writestart progress write abort".split(" ").forEach((function(e){t["on"+e]=v["on"+e]})),t.write(n),v.abort=function(){t.abort(),v.readyState=v.DONE},v.readyState=v.WRITING})),$)})),$)};e.getFile(c,{create:!1},k((function(e){e.remove(),t()})),k((function(e){e.code===e.NOT_FOUND_ERR?t():$()})))})),$)})),$)):$()},f=m.prototype,v=function(e,t){return new m(e,t)};return f.abort=function(){var e=this;e.readyState=e.DONE,l(e,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,e.addEventListener("unload",_,!1),v.unload=function(){_(),e.removeEventListener("unload",_,!1)},v}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports=t}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(178),t=n.n(e);function o(e){e.className=e.dataset.classes,e.innerHTML=`<div class="vdtk_download">\n<img class="base-svg" src="${chrome.runtime.getURL("assets/images/base.svg")}">\n</div>\n<strong class="bar-item-text engagement-text-v23" title="${chrome.i18n.getMessage("download")}">&nbsp;\n<span class="abs">${chrome.i18n.getMessage("download")}</span>\n</strong>`}function r(e){this.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),this.classList.contains("preload")||this.classList.contains("success")||this.classList.contains("error")||(!function(e){let t=document.createElement("img");t.src=chrome.runtime.getURL("assets/images/preloader.svg"),t.classList.add("preloader-svg"),e.querySelector(".vdtk_download").appendChild(t),e.classList.add("preload")}(this),e())}))}const a=function(e){let n;switch(e){case t().M:n="vdtk_svideo";break;case t().N:n="vdtk_grid";break;case t()._:n="vdtk_single";break;case t().k:n="vdtk_4bvideo";break;case t().T:n="vdtk_embed";break;case t().U:n="vdtk_popup";break;case t().B:n="vdtk_explore"}let a=document.createElement("div");return a.dataset.classes=`bar-item-wrapper ${n}`,a.j=r,o(a),a},i=function(e){e.classList.add("success");let t=document.createElement("img");t.src=chrome.runtime.getURL("assets/images/success.svg"),t.classList.add("success-svg"),e.querySelector(".vdtk_download").appendChild(t),setTimeout((function(t){document.body.contains(e)&&o(e)}),5e3)},c=function(e){e.classList.add("error");let t=document.createElement("img");t.src=chrome.runtime.getURL("assets/images/error.svg"),t.classList.add("error-svg"),e.querySelector(".vdtk_download").appendChild(t),setTimeout((function(t){document.body.contains(e)&&o(e)}),5e3)},s=function(e){o(e)};var u=n(798),d=n.n(u),_=n(172),l=n.n(_);function m(e,t=16){let n="",o=e.length;for(let r=0;r<t;r++)n+=e.charAt(Math.floor(Math.random()*o));return n}const f={q(e){if(e.filename_by_title=e.filename_by_title?e.filename_by_title:l().t(e.title,e.author,e.title),e.filename_by_url=e.filename_by_url?e.filename_by_url:l().t(e.video_url,e.author),!e.str_id){let t=null;e.video_id&&"string"==typeof e.video_id?t=e.video_id:e.video_id&&e.video_id[1]&&(t=e.video_id[1]),e.str_id=t}return e.fetch_opt={},e.video_url&&e.video_url.match(/webapp-prime\.(\w+\.)?tiktok\./)&&(e.fetch_opt.credentials="include",e.video_url.includes("TT-vCache")||(e.video_url+="&__vid=TT-vCache-"+e.str_id)),e},R(e,n,o,r="aweme/detail"){let a=t().m,i=Math.round(Date.now()/1e3),c={aweme_id:e,version_name:n,version_code:o,build_number:n,manifest_version_code:o,update_version_code:o,openudid:m("0123456789abcdef",16),uuid:m("0123456789",16),_rticket:1e3*i,ts:i,device_brand:"Google",device_type:"Pixel 4",device_platform:"android",resolution:"1080*1920",dpi:420,os_version:"10",os_api:"29",carrier_region:"US",sys_region:"US",region:"US",app_name:"trill",app_language:"en",language:"en",timezone_name:"America/New_York",timezone_offset:"-14400",channel:"googleplay",ac:"wifi",mcc_mnc:"310260",is_my_cn:0,aid:1180,ssmix:"a",as:"a1qwert123",cp:"cbfhckdckkde1"};return`https://${a}/aweme/v1/${r}/`+Object.keys(c).map(((e,t)=>`${t>0?"&":"?"}${e}=${c[e]}`)).join("")},W:e=>new Promise(((t,n)=>{fetch(e).then((e=>e.json())).then((e=>t(e))).catch((e=>n(e)))}))},v={C:function(e,t){let n=this;Promise.resolve().then((()=>e.video_url?e:n.L(e).then((e=>e&&"error"!==e.status&&e.downloadObject?e.downloadObject:Promise.reject(e))))).then((e=>{e=f.q(e),this.G(e,t)}))},H:e=>new Promise(((t,n)=>{e=f.q(e),chrome.runtime.sendMessage({action:"getNoWatermarkData",videoId:e.str_id},(function(o){if(!o.success)return void n();let r=o.data;const a=["play_addr","play_addr_h264","play_addr_bytevc1","download_addr"];let i=[],c=!1;if(r&&r.aweme_list)for(const t in r.aweme_list){let n=r.aweme_list[t];if(n.aweme_id===e.str_id)for(const e in a){if(!0===c)break;n&&n.video&&n.video[a[e]]&&n.video[a[e]].url_list&&n.video[a[e]].url_list[0]&&(i=n.video[a[e]].url_list,c=!0)}}0==i.length&&n(),e.video_url=i[0],t(e)}))})),J:function(e,t){chrome.runtime.sendMessage({action:"download",downloadObject:e},t)},L:function(e){return chrome.runtime.sendMessage({action:"updateUrl",downloadObject:e})},G:function(e,t){if(!e||!e.video_url)return t({status:"error"});fetch(e.video_url,e?.fetch_opt).then((e=>e.blob())).then((n=>{let o=e.filename_by_title||e.filename_by_url||"";d()(n,o),t({status:"success"})})).catch((e=>{t({status:"error"})}))}};var p={V:function(){let e=this;e.Y(),chrome.tabs.query({active:!0,currentWindow:!0},(function(t){let n=t[0];e.X(),chrome.tabs.sendMessage(n.id,{action:"getVideoList"},(function(t){return chrome.runtime.lastError?n.url.includes("tiktok.com")?void p.K(n.id):p.Z():t.length?void e.ee(t):p.Z()}))}))},Y:function(){let e=this;chrome.runtime.onMessage.addListener((t=>{"update"===t.action&&t.videoList.length&&e.ee(t.videoList)}))},ee:function(e){let t=this;document.querySelectorAll(".empty, .reload").forEach((function(e){e.remove()})),e.forEach((function(e,n){e.video_id&&!document.querySelector(`[data-id="${e.video_id}"]`)&&t.te(e)}))},te:function(e){let n=document.createElement("li"),o=document.querySelector(".list");n.innerHTML=`<div class="media_item" data-id="${e.video_id}">\n<div class="thumb" style="background-image:url(${e.poster});">\n</div>\n<div class="media_actions_list">\n</div>\n</div>`,o.appendChild(n);let r=n.querySelector(".media_actions_list"),u=a(t().U);u.j((function(){v.C(e,(function(e){s(u),e&&"error"!==e.status?"success"===e.status&&i(u):c(u)}))})),r.prepend(u)},K:function(e){document.body.innerHTML+=`<div class="reload"><div class="icon"></div><div class="text">${chrome.i18n.getMessage("popup_reload")}</div></div>`,document.querySelector(".reload .icon").addEventListener("click",(function(t){chrome.tabs.reload(e)}))},Z:function(){document.body.innerHTML+=`<div class="empty"><a href="//tiktok.com"><span>${chrome.i18n.getMessage("popup_to_tiktok")}</span></a></div>`,document.querySelector(".empty a").addEventListener("click",(function(e){chrome.tabs.create({url:"https://www.tiktok.com"})}))},X:function(){let e=this;chrome.storage.local.get(["rate"],(t=>{t.rate||e.ne()}))},ne:function(){let e=document.createElement("div");e.classList.add("stars"),e.innerHTML='<span data-star="1"></span><span data-star="2"></span><span data-star="3"></span><span data-star="4"></span><span data-star="5"></span>',document.querySelector(".rate").append(e),document.querySelectorAll(".rate span[data-star]").forEach((function(e,t){e.addEventListener("click",(function(e){let t=e.target;for(let e=t.parentNode.firstChild;null!==e;e=e.nextSibling)e.classList.remove("select");t.classList.add("select"),t.parentElement.classList.add("active"),t.dataset.star>=4&&chrome.tabs.create({url:`https://chromewebstore.google.com/detail/${chrome.runtime.id}/reviews`}),chrome.storage.local.set({rate:t.dataset.star})}))}))}};p.V()})()})();